

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Usage &mdash; Superphot 0.1.0.post22+ga35acff documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Documentation" href="api.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Superphot
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0.post22+ga35acff
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#light-curve-data-formats">Light Curve Data Formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="#input-output-table-formats">Input/Output Table Formats</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-history.html">Release History</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Superphot</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Usage</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/usage.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<p>Superphot runs in three steps:</p>
<ol class="arabic simple">
<li><p>For each light curve, fit a model to the observations.</p></li>
<li><p>Extract features from those models to be used for classification.</p></li>
<li><p>Using those features, train the classifier, classify the light curves, and validate the classifier performance.</p></li>
</ol>
<p>For basic functionality, Superphot can be run from the command line. For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>superphot-fit light_curve_file.dat --output-dir stored_models/
superphot-extract input_table.txt stored_models/ --output test_data
superphot-classify test_data.txt
</pre></div>
</div>
<p>For more advanced use cases, you can import the module and use some version of the following workflow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">superphot</span> <span class="kn">import</span> <span class="n">fit</span><span class="p">,</span> <span class="n">extract</span><span class="p">,</span> <span class="n">classify</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>

<span class="c1"># Fit the model to the data. Do this for each file.</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">glob</span><span class="p">(</span><span class="s1">&#39;light_curves/*.dat&#39;</span><span class="p">):</span>
    <span class="n">outfile</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;stored_models/&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">light_curve</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">read_light_curve</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>  <span class="c1"># may need to write your own parser</span>
    <span class="n">fit</span><span class="o">.</span><span class="n">two_iteration_mcmc</span><span class="p">(</span><span class="n">light_curve</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>

<span class="c1"># Extract features</span>
<span class="n">data_table</span> <span class="o">=</span> <span class="n">extract</span><span class="o">.</span><span class="n">compile_data_table</span><span class="p">(</span><span class="s1">&#39;input_table.txt&#39;</span><span class="p">)</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">extract</span><span class="o">.</span><span class="n">extract_features</span><span class="p">(</span><span class="n">data_table</span><span class="p">,</span> <span class="s1">&#39;stored_models/&#39;</span><span class="p">)</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="o">~</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span>

<span class="c1"># Initialize the pipeline (can adjust hyperparameters here)</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">classify</span><span class="o">.</span><span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">classify</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">(),</span>
    <span class="n">classify</span><span class="o">.</span><span class="n">MultivariateGaussian</span><span class="p">(</span><span class="n">sampling_strategy</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
    <span class="n">classify</span><span class="o">.</span><span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Do the classification</span>
<span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;probabilities&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">classify</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">classify</span><span class="o">.</span><span class="n">aggregate_probabilities</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>

<span class="c1"># Validate the classifier</span>
<span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;probabilities&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">classify</span><span class="o">.</span><span class="n">validate_classifier</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">train_data</span><span class="p">)</span>
<span class="n">results_validate</span> <span class="o">=</span> <span class="n">classify</span><span class="o">.</span><span class="n">aggregate_probabilities</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span>
<span class="n">classify</span><span class="o">.</span><span class="n">make_confusion_matrix</span><span class="p">(</span><span class="n">results_validate</span><span class="p">,</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">classes_</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="light-curve-data-formats">
<h2>Light Curve Data Formats<a class="headerlink" href="#light-curve-data-formats" title="Permalink to this headline">¶</a></h2>
<p>The light curve data we used in developing this package were stored in <a class="reference external" href="https://github.com/RickKessler/SNANA">SNANA</a> text format.
Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SURVEY</span><span class="p">:</span> <span class="n">PS1MD</span>
<span class="n">SNID</span><span class="p">:</span>  <span class="n">PSc000001</span>
<span class="n">IAUC</span><span class="p">:</span>    <span class="n">UNKNOWN</span>
<span class="n">RA</span><span class="p">:</span>        <span class="mf">52.4530625</span>  <span class="n">deg</span>
<span class="n">DECL</span><span class="p">:</span>       <span class="o">-</span><span class="mf">29.0749750</span>  <span class="n">deg</span>
<span class="n">MWEBV</span><span class="p">:</span> <span class="mf">0.0075</span> <span class="o">+-</span> <span class="mf">0.0003</span> <span class="n">MW</span> <span class="n">E</span><span class="p">(</span><span class="n">B</span><span class="o">-</span><span class="n">V</span><span class="p">)</span>
<span class="n">REDSHIFT_FINAL</span><span class="p">:</span>  <span class="mf">0.1260</span> <span class="o">+-</span> <span class="mf">0.0010</span>  <span class="p">(</span><span class="n">CMB</span><span class="p">)</span>
<span class="n">SEARCH_PEAKMJD</span><span class="p">:</span> <span class="mf">55207.0</span>
<span class="n">FILTERS</span><span class="p">:</span>    <span class="n">griz</span>

<span class="c1"># ======================================</span>
<span class="c1"># TERSE LIGHT CURVE OUTPUT</span>
<span class="c1">#</span>
<span class="n">NOBS</span><span class="p">:</span> <span class="mi">306</span>
<span class="n">NVAR</span><span class="p">:</span>   <span class="mi">7</span>
<span class="n">VARLIST</span><span class="p">:</span>  <span class="n">MJD</span>  <span class="n">FLT</span> <span class="n">FIELD</span>   <span class="n">FLUXCAL</span>   <span class="n">FLUXCALERR</span>    <span class="n">MAG</span>     <span class="n">MAGERR</span>

<span class="n">OBS</span><span class="p">:</span> <span class="mf">55086.6</span> <span class="n">g</span> <span class="n">NULL</span>  <span class="o">-</span><span class="mf">243.440</span> <span class="mf">231.478</span> <span class="n">nan</span> <span class="o">-</span><span class="mf">1.032</span>
<span class="n">OBS</span><span class="p">:</span> <span class="mf">55089.6</span> <span class="n">g</span> <span class="n">NULL</span>  <span class="o">-</span><span class="mf">62.931</span> <span class="mf">13.480</span> <span class="n">nan</span> <span class="o">-</span><span class="mf">0.233</span>
<span class="n">OBS</span><span class="p">:</span> <span class="mf">55095.6</span> <span class="n">g</span> <span class="n">NULL</span>  <span class="o">-</span><span class="mf">15.102</span> <span class="mf">16.238</span> <span class="n">nan</span> <span class="o">-</span><span class="mf">1.167</span>
<span class="n">OBS</span><span class="p">:</span> <span class="mf">55098.6</span> <span class="n">g</span> <span class="n">NULL</span>  <span class="o">-</span><span class="mf">94.646</span> <span class="mf">13.910</span> <span class="n">nan</span> <span class="o">-</span><span class="mf">0.160</span>
<span class="n">OBS</span><span class="p">:</span> <span class="mf">55104.6</span> <span class="n">g</span> <span class="n">NULL</span>  <span class="o">-</span><span class="mf">28.093</span> <span class="mf">12.441</span> <span class="n">nan</span> <span class="o">-</span><span class="mf">0.481</span>
<span class="n">OBS</span><span class="p">:</span> <span class="mf">55191.3</span> <span class="n">g</span> <span class="n">NULL</span>  <span class="o">-</span><span class="mf">27.414</span> <span class="mf">10.304</span> <span class="n">nan</span> <span class="o">-</span><span class="mf">0.408</span>
<span class="n">OBS</span><span class="p">:</span> <span class="mf">55203.3</span> <span class="n">g</span> <span class="n">NULL</span>  <span class="mf">1381.526</span> <span class="mf">18.142</span> <span class="o">-</span><span class="mf">12.851</span> <span class="mf">0.014</span>
<span class="n">OBS</span><span class="p">:</span> <span class="mf">55446.6</span> <span class="n">g</span> <span class="n">NULL</span>  <span class="o">-</span><span class="mf">3.432</span> <span class="mf">9.291</span> <span class="n">nan</span> <span class="o">-</span><span class="mf">2.939</span>
<span class="n">OBS</span><span class="p">:</span> <span class="mf">55449.6</span> <span class="n">g</span> <span class="n">NULL</span>  <span class="mf">9.291</span> <span class="mf">10.095</span> <span class="o">-</span><span class="mf">7.420</span> <span class="mf">1.180</span>
<span class="n">OBS</span><span class="p">:</span> <span class="mf">55452.6</span> <span class="n">g</span> <span class="n">NULL</span>  <span class="o">-</span><span class="mf">2.915</span> <span class="mf">10.422</span> <span class="n">nan</span> <span class="o">-</span><span class="mf">3.881</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Superphot includes a function that can parse data in this format (<a class="reference internal" href="api.html#superphot.fit.read_light_curve" title="superphot.fit.read_light_curve"><code class="xref py py-func docutils literal notranslate"><span class="pre">superphot.fit.read_light_curve()</span></code></a>).
It should also be able to recognize a simple text format like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># MWEBV: 0.0075</span>
<span class="c1"># REDSHIFT: 0.1260</span>
<span class="n">PHASE</span> <span class="n">FLT</span> <span class="n">FLUXCAL</span> <span class="n">FLUXCALERR</span>
<span class="o">-</span><span class="mf">120.4</span> <span class="n">g</span> <span class="o">-</span><span class="mf">243.44</span> <span class="mf">231.478</span>
<span class="o">-</span><span class="mf">117.4</span> <span class="n">g</span> <span class="o">-</span><span class="mf">62.931</span> <span class="mf">13.48</span>
<span class="o">-</span><span class="mf">111.4</span> <span class="n">g</span> <span class="o">-</span><span class="mf">15.102</span> <span class="mf">16.238</span>
<span class="o">-</span><span class="mf">108.4</span> <span class="n">g</span> <span class="o">-</span><span class="mf">94.646</span> <span class="mf">13.91</span>
<span class="o">-</span><span class="mf">102.4</span> <span class="n">g</span> <span class="o">-</span><span class="mf">28.093</span> <span class="mf">12.441</span>
<span class="o">-</span><span class="mf">15.7</span> <span class="n">g</span> <span class="o">-</span><span class="mf">27.414</span> <span class="mf">10.304</span>
<span class="o">-</span><span class="mf">3.7</span> <span class="n">g</span> <span class="mf">1381.526</span> <span class="mf">18.142</span>
<span class="mf">239.6</span> <span class="n">g</span> <span class="o">-</span><span class="mf">3.432</span> <span class="mf">9.291</span>
<span class="mf">242.6</span> <span class="n">g</span> <span class="mf">9.291</span> <span class="mf">10.095</span>
<span class="mf">245.6</span> <span class="n">g</span> <span class="o">-</span><span class="mf">2.915</span> <span class="mf">10.422</span>
<span class="o">...</span>
</pre></div>
</div>
<p>If your data are in an unrecognizable format, you will have to write your own parser.
The data need to end up as an Astropy table with (at least) the following columns and metadata:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PHASE</span></code> is the date of the observation in days relative to discovery (<code class="docutils literal notranslate"><span class="pre">SEARCH_PEAKMJD</span></code> in our case)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FLT</span></code> is the filter</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FLUXCAL</span></code> and <code class="docutils literal notranslate"><span class="pre">FLUXCALERR</span></code> are the flux and its uncertainty</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MWEBV</span></code> is the Milky Way selective extinction <span class="math notranslate nohighlight">\(E(B-V)\)</span> (used to correct the fluxes)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">REDSHIFT</span></code> is the redshift (used to calculate the luminosity distance and cosmological <span class="math notranslate nohighlight">\(K\)</span>-correction)</p></li>
</ul>
<p>Alternatively, if your light curve files include no metadata, you can give the metadata in the input table (see below).</p>
</div>
<div class="section" id="input-output-table-formats">
<h2>Input/Output Table Formats<a class="headerlink" href="#input-output-table-formats" title="Permalink to this headline">¶</a></h2>
<p>Superphot writes all its outputs in Astropy’s <code class="docutils literal notranslate"><span class="pre">ascii.fixed_width_two_line</span></code> format, but it can read any plain text format guessable by Astropy.</p>
<p>The file called <code class="docutils literal notranslate"><span class="pre">input_table.txt</span></code> above must have at least two columns: <code class="docutils literal notranslate"><span class="pre">filename</span></code> (referring to the light curve data file) and <code class="docutils literal notranslate"><span class="pre">type</span></code> (referring to the supernova classification).
The <code class="docutils literal notranslate"><span class="pre">filename</span></code> column is used as the supernova identifier, so each filename must be unique (even if they are in different directories).
The <code class="docutils literal notranslate"><span class="pre">type</span></code> column is used to train the classifier and can be left blank for supernovae not in the training set.
If the required metadata are not in the light curve files, you must also include the columns <code class="docutils literal notranslate"><span class="pre">MWEBV</span></code> and <code class="docutils literal notranslate"><span class="pre">redshift</span></code>.</p>
<p>Superphot’s feature extraction step saves the features in two separate files with the same base name (<code class="docutils literal notranslate"><span class="pre">test_data</span></code> above) but different extensions.
The <code class="docutils literal notranslate"><span class="pre">test_data.txt</span></code> file includes all the supernova metadata, which will be identical to <code class="docutils literal notranslate"><span class="pre">input_table.txt</span></code> unless stored model parameters are missing for any input supernovae.
The <code class="docutils literal notranslate"><span class="pre">test_data.npz</span></code> file includes the features themselves, stored as a compressed multidimensional binary array.</p>
<p>The classification and validation results are also written to text files by <a class="reference internal" href="api.html#superphot.classify.write_results" title="superphot.classify.write_results"><code class="xref py py-func docutils literal notranslate"><span class="pre">superphot.classify.write_results()</span></code></a>.
The tables include the same metadata as the feature extraction step plus columns of probabilities for each possible classification.
In addition, the validation results can be used to create and plot a confusion matrix using <a class="reference internal" href="api.html#superphot.classify.make_confusion_matrix" title="superphot.classify.make_confusion_matrix"><code class="xref py py-func docutils literal notranslate"><span class="pre">superphot.classify.make_confusion_matrix()</span></code></a>.
You can also plot a confusion matrix from stored validation data on the command line with <code class="docutils literal notranslate"><span class="pre">superphot-confuse</span> <span class="pre">validation.txt</span></code>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="API Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Griffin Hosseinzadeh &amp; Frederick Dauphin

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>